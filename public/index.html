<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>KI - Live Trading Sim</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body class="bg">
  <header class="brandbar">
    <div class="brand-left">
      <img src="/assets/Kent_Invest_Logo.png" alt="Kent Invest" class="brandlogo" />
      <div class="brandtitle">KI - Live Trading Sim</div>
    </div>
    <div class="brand-right">
      <div class="hud-cluster">
        <div class="hud-line">
          <span id="connectionBadge" class="pill hud-pill" data-state="connecting">Connecting…</span>
          <span id="phaseBadge" class="pill hud-pill">Phase: Lobby</span>
          <span id="pauseBadge" class="pill hud-pill" data-paused="false">Live</span>
          <button id="introOpenBtn" type="button" class="chip-btn hud-chip">Quick Intro</button>
        </div>
        <div class="hud-news">
          <span class="label">Last News</span>
          <div id="lastNewsHeadline" class="hud-news-text">Waiting for news…</div>
        </div>
      </div>
      <div class="brand-metrics">
        <div class="metric">
          <span class="metric-label">Product</span>
          <span id="productLbl" class="metric-value">Demo Asset</span>
        </div>
        <div class="metric">
          <span class="metric-label">Price</span>
          <span id="priceLbl" class="metric-value">—</span>
        </div>
        <div class="metric">
          <span class="metric-label">Position</span>
          <span id="posLbl" class="metric-value">0</span>
        </div>
        <div class="metric">
          <span class="metric-label">PnL <span class="info-hint inline" data-tooltip="Realized + mark-to-market PnL based on fills and the last trade price.">?</span></span>
          <span id="pnlLbl" class="metric-value">0.00</span>
        </div>
        <div class="metric">
          <span class="metric-label">Avg Cost</span>
          <span id="avgLbl" class="metric-value">—</span>
        </div>
      </div>
      <button id="gameFullscreenBtn" type="button" class="fullscreen-btn" data-fullscreen>Enter Fullscreen</button>
    </div>
  </header>

  <div id="introModal" class="modal hidden" role="dialog" aria-modal="true">
    <div class="modal-surface">
      <div class="modal-header">
        <h2>Welcome to the KI Live Trading Sim</h2>
        <button id="introCloseBtn" class="chip-btn" type="button">Close</button>
      </div>
      <p class="muted">Quick primer to get you trading fast:</p>
      <ul class="intro-list">
        <li>Use the <strong>Order Entry</strong> ticket for market or limit orders; cancel all when you need a fresh slate.</li>
        <li>The <strong>Depth of Market</strong> highlights best bid/ask and your live resting orders.</li>
        <li>Watch <strong>PnL</strong> and average cost in the HUD; fills plot as arrows on the chart.</li>
        <li>News headlines move the fair value—stay alert for color changes in the ticker.</li>
      </ul>
      <div class="modal-actions">
        <button id="introDismissBtn" type="button">Let’s trade</button>
      </div>
    </div>
  </div>

  <!-- JOIN -->
  <section id="joinView" class="center">
    <div class="card">
      <h1>Join the Market</h1>
      <div class="row">
        <input id="nameInput" placeholder="Your name" />
        <button id="joinBtn">Join</button>
      </div>
      <p class="muted" id="joinMsg">Enter your name to join the waiting room.</p>
      <button id="joinFullscreenBtn" type="button" class="fullscreen-btn" data-fullscreen>Enter Fullscreen</button>
    </div>
  </section>

  <!-- WAITING ROOM (shows roster) -->
  <section id="waitView" class="center hidden">
    <div class="card">
      <h2>Waiting for host to start…</h2>
      <p class="muted">You’re in. You’ll switch automatically when the game starts.</p>
      <h3>Players joined</h3>
      <ul id="roster" class="roster"></ul>
      <button id="waitFullscreenBtn" type="button" class="fullscreen-btn" data-fullscreen>Enter Fullscreen</button>
    </div>
  </section>

  <!-- GAME -->
  <section id="gameView" class="page hidden">
    <div id="newsBar" class="news"><span id="newsText">Waiting for news…</span></div>

    <div class="game-shell">
      <div class="left-col">
        <div class="chart-row">
          <div class="panel card side-widget">
            <div class="panel-header">
              <h3>Signal</h3>
            </div>
            <div class="side-widget-body">
              <div class="side-widget-item">
                <span class="label">Momentum</span>
                <strong class="side-widget-value">Neutral</strong>
              </div>
              <div class="side-widget-item">
                <span class="label">Volatility</span>
                <strong class="side-widget-value">Normal</strong>
              </div>
              <div class="side-widget-item">
                <span class="label">Bias</span>
                <strong class="side-widget-value">Balanced</strong>
              </div>
            </div>
          </div>

          <div class="panel card chart-card">
            <div class="panel-header">
              <h3>Price Chart</h3>
              <div class="panel-tools">
                <span class="mode-label">Candlesticks</span>
                <span id="chartModeBadge" class="pill pill-mode">—</span>
              </div>
            </div>
            <div class="chart-wrap">
              <div id="chart" class="chart-surface"></div>
            </div>
          </div>
        </div>

        <div class="lower-panels">
          <div class="panel card chat-card">
            <div class="panel-header">
              <h3>Floor Chat</h3>
            </div>
            <div id="chatLog" class="chat-log"></div>
            <form id="chatForm" class="chat-form">
              <input id="chatInput" placeholder="Say something…" autocomplete="off" />
              <button type="submit">Send</button>
            </form>
          </div>

          <div class="panel card trade-card">
            <div class="panel-header trade-header">
            <h3>Order Entry <span class="info-hint" data-tooltip="Submit market or limit orders. Use Cancel All to clear resting bids/asks.">?</span></h3>
            <div class="order-type-toggle">
              <span class="order-type-label">Order Type</span>
              <label><input type="radio" name="orderType" value="market" checked /> Market</label>
              <label><input type="radio" name="orderType" value="limit" /> Limit</label>
              <label><input type="radio" name="orderType" value="iceberg" /> Iceberg</label>
              <label><input type="radio" name="orderType" value="algo" /> Bot</label>
              <label><input type="radio" name="orderType" value="dark" /> Dark Pool</label>
            </div>
            </div>
            <form id="tradeForm" class="trade-form">
              <div class="form-row form-row-qty">
                <label for="quantityInput">Volume</label>
                <input id="quantityInput" type="number" step="1" min="1" value="1" />
              </div>
              <div class="form-row form-row-limit hidden" id="limitPriceRow">
                <label for="priceInput">Limit Price</label>
                <input id="priceInput" type="number" step="0.25" inputmode="decimal" placeholder="Price" />
              </div>
              <div class="form-row form-row-display hidden" id="displayQtyRow">
                <label for="displayQtyInput">Display Qty</label>
                <input id="displayQtyInput" type="number" step="1" min="1" placeholder="Visible slice" />
              </div>
              <div class="form-row form-row-algo hidden" id="aggressivenessRow">
                <label for="aggressivenessInput">Aggressiveness (%)</label>
                <input id="aggressivenessInput" type="number" step="1" min="0" max="100" value="50" />
              </div>
              <div class="open-orders">
                <ul id="openOrders" class="orders-list"></ul>
              </div>
              <div id="tradeStatus" class="trade-status muted"></div>
              <div class="form-actions">
                <button type="button" id="sellBtn" class="sell">Sell</button>
                <button type="button" id="buyBtn" class="buy">Buy</button>
                <button type="button" id="cancelAllBtn" class="secondary cancel">Cancel All</button>
              </div>
            </form>
          </div>
        </div>
      </div>

      <div class="dom-col">
        <div class="panel card book-card dom-card">
          <div class="panel-header">
            <h3>Depth of Market <span class="info-hint" data-tooltip="See live bids/asks. Best levels glow; your resting orders are marked." aria-label="Depth of Market help">?</span></h3>
            <div class="panel-tools book-tools">
              <button id="bookScrollToggle" type="button" class="chip-btn">Auto Scroll: On</button>
              <span id="bookSpread">Spread: —</span>
              <span id="bookModeBadge" class="pill pill-mode">—</span>
            </div>
          </div>
          <div class="book-switch" role="tablist" aria-label="Book view">
            <button type="button" class="book-tab active" data-view="dom" aria-pressed="true">DOM</button>
            <button type="button" class="book-tab" data-view="dark" aria-pressed="false">Dark Pool</button>
          </div>
          <div class="dom-header" aria-hidden="true">
            <span>Sell Vol</span>
            <span>Price</span>
            <span>Buy Vol</span>
          </div>
          <div class="orderbook" id="bookBody"></div>
          <div class="orderbook hidden" id="darkBookBody"></div>
        </div>
      </div>
    </div>
  </section>

  <script src="/socket.io/socket.io.js"></script>
  <script src="https://unpkg.com/lightweight-charts@4.2.1/dist/lightweight-charts.standalone.production.js"></script>
  <script src="script.js"></script>
</body>
</html>
